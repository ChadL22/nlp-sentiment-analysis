<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VADER vs. BERT Sentiment Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/toxicity"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .analyzer-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        .button-primary {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .button-primary:hover {
            background-color: #2980b9;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        .model-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .model-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .model-card h3 {
            color: #3498db;
            margin-top: 0;
        }
        
        .score-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .score-vader {
            color: #2980b9;
        }
        
        .score-bert {
            color: #8e44ad;
        }
        
        .sentiment-positive {
            color: #27ae60;
        }
        
        .sentiment-neutral {
            color: #f39c12;
        }
        
        .sentiment-negative {
            color: #e74c3c;
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e1e1;
        }
        
        .comparison-table th {
            background-color: #f1f4f7;
        }
        
        .example-texts {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .example-text {
            background-color: #f1f4f7;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .example-text:hover {
            background-color: #e1e7ed;
        }
        
        .loading {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .model-results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>VADER vs. BERT Sentiment Analysis</h1>
            <p class="subtitle">Compare how rule-based and neural approaches analyze sentiment</p>
        </div>
    </header>

    <main class="container">
        <div class="analyzer-container">
            <h2>Interactive Sentiment Analyzer</h2>
            <p>Enter a text to analyze its sentiment using both VADER (rule-based) and BERT (neural network) models:</p>
            
            <textarea id="textInput" placeholder="Type or paste text here..."></textarea>
            
            <div class="example-texts">
                <span class="example-text" onclick="useExampleText(this)">I absolutely loved this movie!</span>
                <span class="example-text" onclick="useExampleText(this)">The food was terrible and the service was slow.</span>
                <span class="example-text" onclick="useExampleText(this)">The product works as expected.</span>
                <span class="example-text" onclick="useExampleText(this)">I was not unhappy with the results.</span>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="button-primary" onclick="analyzeSentiment()">Analyze Sentiment</button>
            </div>
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Analyzing sentiment...</p>
            </div>
            
            <div id="results" class="results-container">
                <h3>Analysis Results</h3>
                
                <div class="model-results">
                    <div class="model-card">
                        <h3>VADER</h3>
                        <p>Rule-based approach with lexicon and heuristic rules</p>
                        
                        <div class="score-container">
                            <div id="vaderScoreValue" class="score-value score-vader">0.0</div>
                            <div id="vaderSentiment">Neutral</div>
                        </div>
                        
                        <div>
                            <table class="comparison-table">
                                <tr>
                                    <th>Component</th>
                                    <th>Score</th>
                                </tr>
                                <tr>
                                    <td>Positive</td>
                                    <td id="vaderPositive">0.0</td>
                                </tr>
                                <tr>
                                    <td>Neutral</td>
                                    <td id="vaderNeutral">0.0</td>
                                </tr>
                                <tr>
                                    <td>Negative</td>
                                    <td id="vaderNegative">0.0</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="model-card">
                        <h3>BERT</h3>
                        <p>Neural network approach with contextual understanding</p>
                        
                        <div class="score-container">
                            <div id="bertScoreValue" class="score-value score-bert">0.0</div>
                            <div id="bertSentiment">Neutral</div>
                        </div>
                        
                        <div>
                            <table class="comparison-table">
                                <tr>
                                    <th>Prediction</th>
                                    <th>Confidence</th>
                                </tr>
                                <tr>
                                    <td>Positive</td>
                                    <td id="bertPositive">0.0%</td>
                                </tr>
                                <tr>
                                    <td>Negative</td>
                                    <td id="bertNegative">0.0%</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
                
                <div class="model-card" style="margin-top: 30px;">
                    <h3>Key Differences in Analysis</h3>
                    <p id="analysisExplanation">Enter text above to see how VADER and BERT analyze sentiment differently.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        let comparisonChart = null;
        
        function useExampleText(element) {
            document.getElementById('textInput').value = element.textContent;
        }
        
        async function analyzeSentiment() {
            let text = document.getElementById("textInput").value;
            
            if (text.trim() === "") {
                alert("Please enter some text to analyze.");
                return;
            }
            
            // Show loading indicator
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            try {
                // VADER (Rule-Based) Analysis
                let Sentiment = window["sentiment"];
                let vaderAnalyzer = new Sentiment();
                let vaderResult = vaderAnalyzer.analyze(text);
                
                // Convert VADER score (-5 to 5 scale) to -1 to 1 scale
                let vaderScore = vaderResult.score / 5;
                vaderScore = Math.max(-1, Math.min(1, vaderScore)); // Clamp between -1 and 1
                
                // Calculate positive, neutral, negative components
                let vaderPositive = 0;
                let vaderNegative = 0;
                let vaderNeutral = 0;
                
                // Simple approximation of VADER components
                if (vaderScore > 0) {
                    vaderPositive = vaderScore;
                    vaderNeutral = 1 - vaderScore;
                } else if (vaderScore < 0) {
                    vaderNegative = Math.abs(vaderScore);
                    vaderNeutral = 1 - Math.abs(vaderScore);
                } else {
                    vaderNeutral = 1;
                }
                
                // BERT (TensorFlow.js) Analysis
                const model = await toxicity.load(0.5);
                let predictions = await model.classify(text);
                
                let toxicityPrediction = predictions.find(pred => pred.label === "toxicity");
                let isToxic = toxicityPrediction ? toxicityPrediction.results[0].match : false;
                let bertNegProb = toxicityPrediction ? toxicityPrediction.results[0].probabilities[1] : 0.5;
                let bertPosProb = 1 - bertNegProb;
                
                // Convert toxicity to sentiment score (-1 to 1 scale)
                let bertScore = bertPosProb - bertNegProb;
                
                // Determine sentiment labels
                let vaderSentiment = getSentimentLabel(vaderScore);
                let bertSentiment = getSentimentLabel(bertScore);
                
                // Update UI with results
                document.getElementById('vaderScoreValue').textContent = vaderScore.toFixed(2);
                document.getElementById('vaderSentiment').textContent = vaderSentiment;
                document.getElementById('vaderSentiment').className = getSentimentClass(vaderSentiment);
                
                document.getElementById('bertScoreValue').textContent = bertScore.toFixed(2);
                document.getElementById('bertSentiment').textContent = bertSentiment;
                document.getElementById('bertSentiment').className = getSentimentClass(bertSentiment);
                
                // Update component scores
                document.getElementById('vaderPositive').textContent = (vaderPositive * 100).toFixed(1) + '%';
                document.getElementById('vaderNeutral').textContent = (vaderNeutral * 100).toFixed(1) + '%';
                document.getElementById('vaderNegative').textContent = (vaderNegative * 100).toFixed(1) + '%';
                
                document.getElementById('bertPositive').textContent = (bertPosProb * 100).toFixed(1) + '%';
                document.getElementById('bertNegative').textContent = (bertNegProb * 100).toFixed(1) + '%';
                
                // Generate explanation of differences
                document.getElementById('analysisExplanation').innerHTML = generateExplanation(text, vaderScore, bertScore, vaderSentiment, bertSentiment);
                
                // Update chart
                updateComparisonChart(vaderPositive, vaderNeutral, vaderNegative, bertPosProb, 0, bertNegProb);
                
                // Show results
                document.getElementById('results').style.display = 'block';
            } catch (error) {
                console.error('Error analyzing sentiment:', error);
                alert('There was an error analyzing the sentiment. Please try again.');
            } finally {
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function getSentimentLabel(score) {
            if (score >= 0.05) return "Positive";
            if (score <= -0.05) return "Negative";
            return "Neutral";
        }
        
        function getSentimentClass(sentiment) {
            if (sentiment === "Positive") return "sentiment-positive";
            if (sentiment === "Negative") return "sentiment-negative";
            return "sentiment-neutral";
        }
        
        function updateComparisonChart(vaderPos, vaderNeu, vaderNeg, bertPos, bertNeu, bertNeg) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['VADER', 'BERT'],
                    datasets: [
                        {
                            label: 'Positive',
                            data: [vaderPos * 100, bertPos * 100],
                            backgroundColor: '#27ae60'
                        },
                        {
                            label: 'Neutral',
                            data: [vaderNeu * 100, bertNeu * 100],
                            backgroundColor: '#f39c12'
                        },
                        {
                            label: 'Negative',
                            data: [vaderNeg * 100, bertNeg * 100],
                            backgroundColor: '#e74c3c'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sentiment Component Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Sentiment Proportion (%)'
                            }
                        }
                    }
                }
            });
        }
        
        function generateExplanation(text, vaderScore, bertScore, vaderSentiment, bertSentiment) {
            let explanation = '';
            
            if (vaderSentiment === bertSentiment) {
                explanation = `<p>Both models agree that this text has a <strong class="${getSentimentClass(vaderSentiment)}">${vaderSentiment.toLowerCase()}</strong> sentiment.</p>`;
                
                if (Math.abs(vaderScore - bertScore) > 0.3) {
                    explanation += `<p>However, VADER (${vaderScore.toFixed(2)}) and BERT (${bertScore.toFixed(2)}) differ in how strong they consider this sentiment to be.</p>`;
                }
            } else {
                explanation = `<p>The models disagree on this text:</p>
                <ul>
                    <li>VADER classifies it as <strong class="${getSentimentClass(vaderSentiment)}">${vaderSentiment.toLowerCase()}</strong> (${vaderScore.toFixed(2)})</li>
                    <li>BERT classifies it as <strong class="${getSentimentClass(bertSentiment)}">${bertSentiment.toLowerCase()}</strong> (${bertScore.toFixed(2)})</li>
                </ul>`;
                
                // Add possible explanations for disagreement
                if (text.includes('not') || text.includes("n't")) {
                    explanation += `<p>This disagreement might be because the text contains negations, which VADER's rule-based approach explicitly handles, while BERT might interpret the context differently.</p>`;
                }
                
                if (text.length > 100) {
                    explanation += `<p>The text is relatively long, which might benefit BERT's contextual understanding compared to VADER's word-by-word approach.</p>`;
                }
            }
            
            return explanation;
        }
        
        // Initialize with example when page loads
        window.onload = function() {
            document.getElementById('textInput').value = "I absolutely loved this movie!";
        };
    </script>
</body>
</html>